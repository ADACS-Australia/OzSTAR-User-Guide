

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Submitting Jobs on Green II (qsub) &mdash; OzSTAR User Guide  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="OzSTAR User Guide  documentation" href="../index.html"/>
        <link rel="prev" title="Job Queues on Green II" href="g2-Queue.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

      
        <!-- a href="../index.html" -->
        <a href="http://136.186.54.54"><!-- target="_blank"-->
      

      
        
        <img src="../_static/OzStar-FA-Mono-KEYLINE.png" class="logo" />
      
      </a>

      

      
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

      
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1-getting_started/Accounts.html">Accounts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-getting_started/Access.html">Access the supercomputer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-getting_started/file-transfer.html">File Transfer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-getting_started/Profiling.html">Profiling your code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-getting_started/Swinburne-HPC.html">Swinburne HPC system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1-getting_started/FAQ.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">OzSTAR vs Green II</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../1a-oz_g2/what-s-new.html">What’s new on OzSTAR?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1a-oz_g2/Filesystems.html">File systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1a-oz_g2/Modules.html">Environment Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../1a-oz_g2/torque-vs-slurm.html">Torque-Moab vs Slurm</a></li>
</ul>
<p class="caption"><span class="caption-text">Jobs on OzSTAR</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../2-ozstar/oz-partition.html">Job Queues on OzSTAR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2-ozstar/oz-slurm-basics.html">Slurm: basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2-ozstar/oz-slurm-details.html">Slurm: gathering information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2-ozstar/oz-slurm-create.html">Slurm: Creating a job</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2-ozstar/oz-slurm-examples.html">Slurm: script examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Jobs on Green II</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="g2-Queue.html">Job Queues on Green II</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Submitting Jobs on Green II (qsub)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#submitting-interactive-jobs">Submitting Interactive Jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-pbs-script-job">Running PBS Script Job</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pbs-directive">PBS Directive</a></li>
<li class="toctree-l3"><a class="reference internal" href="#viewing-job-output">Viewing Job Output</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample-pbs-script">Sample PBS Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Specifying PBS Resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#gpu-device-locking">GPU device locking</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OzSTAR User Guide</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Submitting Jobs on Green II (qsub)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="submitting-jobs-on-green-ii-qsub">
<h1>Submitting Jobs on Green II (qsub)<a class="headerlink" href="#submitting-jobs-on-green-ii-qsub" title="Permalink to this headline">¶</a></h1>
<p>Green II uses a batch server referred to as the cluster management server, which is running on the g2 head node. This batch server monitors the status of the supercomputer and controls/monitors the available queues and the currently active jobs. <a class="reference external" href="http://docs.adaptivecomputing.com/torque/4-1-4/Content/topics/commands/qsub.htm">qsub</a> is the how you can interact with the batch server. It takes several command line arguments and can also use special directives in the submission scripts. You can have more details about <code class="docutils literal notranslate"><span class="pre">qsub</span></code> by:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>man qsub
</pre></div>
</div>
<p>There are two modes of using the qsub command: <strong>Interactive Job Submission</strong>, and <strong>PBS Script Jobs</strong>.</p>
<p>In both of these modes, you have to specify which queue resources will be used for your job (using -q parameter). You can select one of the following queues (for more details about each queue resources and limitations see job queue):</p>
<ul class="simple">
<li>gstar</li>
<li>manygpu</li>
<li>sstar</li>
<li>largemem</li>
</ul>
<p>Please note that some of these queues are not available for non-Swinburne users.</p>
<p><strong>Other useful Commands:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">qdel</span></code>: Delete a batch job</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">qstat</span></code>: Show status of all jobs (The time displayed is the CPU time used by the job)</dt>
<dd><ul class="first last">
<li><code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-s</span></code>: Show status of all jobs (The time displayed is the walltime used by the job)</li>
<li><code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-u</span> <span class="pre">[userid]</span></code>: Shows the status all PBS jobs submitted by the user [userid] (The time displayed is the walltime used by the job).</li>
<li><code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-n</span></code>: Shows the status all PBS jobs along with a list of compute nodes that the job is running on.</li>
<li><code class="docutils literal notranslate"><span class="pre">qstat</span> <span class="pre">-f</span> <span class="pre">[jobid]</span></code>: Shows detailed information about the job [jobid].</li>
</ul>
</dd>
</dl>
</li>
<li><code class="docutils literal notranslate"><span class="pre">qps</span></code>: Show processes (or optionally threads) currently running in your jobs.</li>
<li><code class="docutils literal notranslate"><span class="pre">qcat</span></code>: Show output (stdout, or optionally stderr) from your currently running jobs.</li>
<li><code class="docutils literal notranslate"><span class="pre">showq</span></code>: Displays information about active, eligible, blocked, and/or recently completed jobs. For more information about <code class="docutils literal notranslate"><span class="pre">showq</span></code>, see <a class="reference external" href="http://docs.adaptivecomputing.com/maui/commands/showq.php">this page</a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">showstart</span></code>: displays the estimated start time of a job. Please note that this is an estimation that might changes depending on different run-time factors. For more information about <code class="docutils literal notranslate"><span class="pre">showstart</span></code>, click <a class="reference external" href="http://docs.adaptivecomputing.com/maui/commands/showstart.php">this page</a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">checkjob</span></code>:displays detailed job state information and diagnostic output for a specified job. For more information about <code class="docutils literal notranslate"><span class="pre">checkjob</span></code>, see <a class="reference external" href="http://docs.adaptivecomputing.com/maui/commands/checkjob.php">this page</a>.</li>
</ul>
<div class="section" id="submitting-interactive-jobs">
<h2>Submitting Interactive Jobs<a class="headerlink" href="#submitting-interactive-jobs" title="Permalink to this headline">¶</a></h2>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>qsub -q [Queue Name] -A [Your Project ID] -I -l [Resources Required]
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">-q</span> <span class="pre">[Queue</span> <span class="pre">Name]</span></code>: parameter is used to set the queue you want to get an interactive node from.</li>
<li><code class="docutils literal notranslate"><span class="pre">-A</span> <span class="pre">[Your</span> <span class="pre">Project</span> <span class="pre">ID]</span></code>: parameter is used to deduct this usage from a specific project (e.g p001_swin). You must be a member of that group.</li>
<li><code class="docutils literal notranslate"><span class="pre">-l</span> <span class="pre">[Resources</span> <span class="pre">Required]</span></code>: parameter is used to set the resources requested from the queue. (e.g walltime=1:0:0,nodes=1:ppn=1:gpus=1,mem=2000MB - See <a class="reference external" href="https://supercomputing.swin.edu.au/user-guide/submitting-jobs/#PBS_Resources">Specifying PBS Resources</a> for more details.)</li>
<li><code class="docutils literal notranslate"><span class="pre">-I</span></code>: parameter is used to specify that you want an interactive job.</li>
</ul>
<p>The session will be active as long as your session remains connected. When you wish to terminate the job simply type <code class="docutils literal notranslate"><span class="pre">exit</span></code>.</p>
</div>
<div class="section" id="running-pbs-script-job">
<h2>Running PBS Script Job<a class="headerlink" href="#running-pbs-script-job" title="Permalink to this headline">¶</a></h2>
<p>A PBS script file is a standard Linux shell script file that contains a few extra comments at the beginning that specify directives to PBS to describe the resources needed, and which queue do you want to use. These comments all begin with #PBS. The most important PBS directives are:</p>
<div class="section" id="pbs-directive">
<h3>PBS Directive<a class="headerlink" href="#pbs-directive" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-l</span> <span class="pre">walltime=HH:MM:SS</span></code>:</dt>
<dd><ul class="first last">
<li>This directive specifies the maximum walltime (real time) that a job should take. If this limit is exceeded, PBS will stop the job. Keeping this limit close to the actual expected time of a job can allow a job to start more quickly.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-l</span> <span class="pre">pmem=SIZEgb</span></code>:</dt>
<dd><ul class="first last">
<li>This directive specifies the maximum amount of physical memory used by any process in the job. For example, if the job would run four processes and each would use up to 4 GB (gigabytes) of memory, then the directive would read #PBS -l pmem=4gb and this mean the maximum job memory requirements is 16GB.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-l</span> <span class="pre">nodes=N:ppn=M</span></code>:</dt>
<dd><ul class="first last">
<li>This directive specifies the number of nodes (nodes=N) and the number of processors per node (ppn=M) that the job should use.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-q</span> <span class="pre">queuename</span></code>:</dt>
<dd><ul class="first last">
<li>This directive specifies the PBS queue this job should be submitted to.                                                                                                                                      - <code class="docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-N</span> <span class="pre">Job_name</span></code>:</li>
<li>This directive specifies the Job Name.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-A</span> <span class="pre">Project_ID</span></code>:</dt>
<dd><ul class="first last">
<li>If you are a member of multiple projects, This directive specifies the Project ID.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>A PBS Script file can be submitted using:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>qsub scriptfile
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">qsub</span></code> command will return a job ID. It should in the form of <code class="docutils literal notranslate"><span class="pre">[job</span> <span class="pre">Number].pbs.hpc.swin.edu.au</span></code>. This ID can be used later to control/monitor the job.</p>
</div>
<div class="section" id="viewing-job-output">
<h3>Viewing Job Output<a class="headerlink" href="#viewing-job-output" title="Permalink to this headline">¶</a></h3>
<p>By default PBS will write screen output from a job to the follwing files:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">[Jobname].o[Job_ID]</span></code>: This file would contain the non-error output.</li>
<li><code class="docutils literal notranslate"><span class="pre">[Jobname].e[Job_ID]</span></code>: This file would contain the error output.</li>
</ul>
<p>If the PBS directive <code class="docutils literal notranslate"><span class="pre">#PBS</span> <span class="pre">-j</span> <span class="pre">oe</span></code> is used in a PBS script, the non-error and the error output are both written to the Jobname.oJob_ID file.</p>
</div>
<div class="section" id="sample-pbs-script">
<h3>Sample PBS Script<a class="headerlink" href="#sample-pbs-script" title="Permalink to this headline">¶</a></h3>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>#!/bin/csh
# specify the queue name
#PBS -q gstar
# resource requests
#PBS -l nodes=1:ppn=6:gpus=1
#PBS -l walltime=01:00:00:00

# list the assigned CPUs and GPUs
echo Deploying job to CPUs ...
cat $PBS_NODEFILE
echo and using GPU ...
cat $PBS_GPUFILE

# run process
./a.out &lt; inputX
PBS Environment Variables
</pre></div>
</div>
<p>The following environment variables will be provided for your job via the PBS system.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">$PBS_O_WORKDIR</span></code>: absolute path of the current working directory.</li>
<li><code class="docutils literal notranslate"><span class="pre">$PBS_ENVIRONMENT</span></code>: set to PBS_BATCH to indicate the job is a batch job, or to PBS_INTERACTIVE to indicate the job is a PBS interactive job</li>
<li><code class="docutils literal notranslate"><span class="pre">$PBS_JOBID</span></code>: the job ID assigned to the job.</li>
<li><code class="docutils literal notranslate"><span class="pre">$PBS_JOBNAME</span></code>: the job name supplied by your script. Check -N option.</li>
<li><code class="docutils literal notranslate"><span class="pre">$PBS_NODEFILE</span></code>: the path of the file contains the list of nodes assigned to the job</li>
<li><code class="docutils literal notranslate"><span class="pre">$PBS_QUEUE</span></code>: the name of the queue used to execute the job.</li>
<li><code class="docutils literal notranslate"><span class="pre">$PBS_GPUFILE</span></code>: the path of the file contains the list of GPU .assigned to the job.</li>
</ul>
</div>
<div class="section" id="id1">
<h3>Specifying PBS Resources<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>To get a summary of the resources supported by PBS for gSTAR use:</p>
<div class="highlight-rst notranslate"><div class="highlight"><pre><span></span>man pbs_resources
</pre></div>
</div>
<p>These resources are specified by including them in the -l option argument on the qsub command or in the PBS job script. As a specialized resource you can ask for gpus per node by using “gpus=” as one of the resources. If you did not explicitly ask for GPU, the scheduler will assume that you don’t need one.</p>
</div>
</div>
<div class="section" id="gpu-device-locking">
<h2>GPU device locking<a class="headerlink" href="#gpu-device-locking" title="Permalink to this headline">¶</a></h2>
<p>To avoid possible conflicts when multiple users are using the same node, we currently have a policy where a GPU is locked to a user when assigned to that user through the job queue. This is done by temporarily changing the permissions of the device to give ownership to the user. However, this does present a known issue when using the <code class="docutils literal notranslate"><span class="pre">nvidia-sim</span> <span class="pre">-a</span></code> command to perform device queries. For example, if person A is already using GPU-0 on the node (and thus has ownership of it) then when another person queries the available devices it will only detect one device (GPU-1) and will refer to it as device 0. In such cases it is advisable to use other methods to pick up the allocated device number (such as using the PBS_GPUFILE in the example below).</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="g2-Queue.html" class="btn btn-neutral" title="Job Queues on Green II" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
    
      <style>
        /* Sidebar header (and topbar for mobile) */
        .wy-side-nav-search, .wy-nav-top {
          background: #000000;
        }
        /* Sidebar */
        /*.wy-nav-side {*/
          /*background: #ff0000;*/
        /*}*/
      </style>
    

</body>
</html>