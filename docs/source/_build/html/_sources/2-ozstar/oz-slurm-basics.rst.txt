.. highlight:: rst

Slurm: basics
==================================

Brief Command Summary
------------------------
- Job control and monitoring:  ``scontrol`` and ``squeue``.
- Submit batch jobs: ``sbatch``.
- Request interactive job sessions: through ``salloc``.
- Launch/running a job: ``srun``.
- Nodes info and cluster status: ``sinfo``.
- Job and job steps accounting data: ``sacct``.
- Cancel a job: ``scancel jobid``.
    * Cancel all your jobs: ``scancel -u username``.
    * Cancel all your pending jobs:``scancel -t PD``.

Slurm keywords
--------------------

**Required sbatch Options/Directives**

+--------------+----------------------+--------------------------------------------------------------------------------------------------------------------------+
| Short Format | Long Format          | Description                                                                                                              |
+==============+======================+==========================================================================================================================+
| -N count     | --nodes=count        | Used to allocate countnodes to your job.                                                                                 |
+--------------+----------------------+--------------------------------------------------------------------------------------------------------------------------+
| -t HH:MM:SS  | --time=HH:MM:SS      | Always specify the maximum wallclock time for your job.                                                                  |
+--------------+----------------------+--------------------------------------------------------------------------------------------------------------------------+
| -C feature   | --constraint=feature | Always specify what type of nodes to run.                                                                                |
+--------------+----------------------+--------------------------------------------------------------------------------------------------------------------------+
| -q QoS       | --qos=QoS            | Always specify your QoS (debug, regular, etc), which will usually be debug for testing and regular for production runs.  |
+--------------+----------------------+--------------------------------------------------------------------------------------------------------------------------+

**Useful sbatch Options/Directives**

+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Short Format           | Long Format                            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
+========================+========================================+=============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| N/A                    | --ntasks-per-node=count                | Use [count] of MPI tasks per node                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -c count               | --cpus-per-task=count                  | Set the value as "number of of logical cores (CPUs) per MPI task". For example, on Cori Haswell, it is 64 logical cores divided by #MPI_per_node.                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -L list_of_filesystems | --license=list_of_filesystems          | Specifies the file systems (in a comma-separated list) needed for your job. Available choices for Cori are: cscratch1 (or SCRATCH), dna, project, projecta, projectb. More details on requesting file system licenses can be found here.                                                                                                                                                                                                                                                                                                                                                                                    |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -J job_name            | --job-name=job_name                    | job_name: up to 15 printable, non-whitespace characters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -A repo                | --account=repo                         | Charge this job to the project repo                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -e filename            | --error=filename                       | Write STDERR to filename                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -o filename            | --output=filename                      | Write STDOUT to filename. By default both standard output and standard error are directed to a file of the name "slurm-%j.out", where the "%j" is replaced with the job id. See the -i option for filename specification options.                                                                                                                                                                                                                                                                                                                                                                                           |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -i filename_pattern    | --input=filename_pattern               | Instruct SLURM to connect the batch script's standard input directly to the file name specified in the "filename pattern".The filename pattern may contain one or more replacement symbols, which are a percent sign "%" followed by a letter (e.g. %j).Supported replacement symbols are:%jJob id.%NNode name. Only one file is created, so %N will be replaced by the name of the first compute node in the job, which is the one that runs the script.                                                                                                                                                                   |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| N/A                    | --mail-type=events --mail-user=address | Valid event values are: BEGIN, END, FAIL, REQUEUE, ALL (equivalent to BEGIN, END, FAIL, REQUEUE, and STAGE_OUT), STAGE_OUT (burst buffer stage out completed), TIME_LIMIT, TIME_LIMIT_90 (reached 90 percent of time limit), TIME_LIMIT_80 (reached 80 percent of time limit), and TIME_LIMIT_50 (reached 50 percent of time limit). Multiple type values may be specified in a comma separated list. The user to be notified is indicated with --mail-user. Mail notifications on job BEGIN, END and FAIL apply to a job array as a whole rather than generating individual email messages for each task in the job array. |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -D directory_name      | --workdir=directory_name               | Set the working directory of the batch script to directory_name before it is executed. The path can be specified as full path or relative path to the directory where the sbatch command is executed.                                                                                                                                                                                                                                                                                                                                                                                                                       |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| N/A                    | --export=ALL                           | Export the current environment variables into the batch job environment.  This is the default behavior.  Other options (not recommended to use) are specific list of environment variables, or NONE.                                                                                                                                                                                                                                                                                                                                                                                                                        |
+------------------------+----------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

